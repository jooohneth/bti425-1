<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bootstrap with Data</title>

    <!-- Bootstrap 5.1 CSS-->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <!-- Bootstrap 5.1 JS Bundle -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>

    <script>

        async function populatePostsTable(userId = null){
            let url = +userId // attempt to convert userId to a number
            ? "https://jsonplaceholder.typicode.com/posts?userId=${+userId}"
            : "https://jsonplaceholder.typicode.com/posts;"

            let res = await fetch(url);
            let data = await res.json();

            // <div id="postsTable">
            //   <tbody>     
            //     {data.map(element => {
            //       <tr data-id={element.id}>
            //         <td>{element.userId}</td>
            //         <td>{element.title}</td>
            //         <td>{element.body}</td> 
            //       </tr>
            //     })}  
            //   </tbody>
            // </div>

            let tableRows = `
                ${data.map(element => `
                    <tr data-id="${element.id}">    
                        <td>${element.userId}</td> 
                        <td>${element.title}</td>
                        <td>${element.body}</td>    
                    </tr>
                `).join("")}
            `;

            document.querySelector("#postsTable tbody").innerHTML = tableRows;

            document.querySelectorAll("#postsTable tbody tr").forEach(element => {
                element.addEventListener("click", async (event)=>{
                    let postID = element.getAttribute("data-id");
                    
                    let res = await fetch(`https://jsonplaceholder.typicode.com/comments?postId=${postID}`);
                    let data = await res.json();

                    let commentsList = `
                        <ul class="list-group">
                            ${data.map(element => `
                                <li class="list-group-item">
                                    ${element.body}<br /><br />
                                    <strong>Name:</strong> ${element.name}<br />
                                    <strong>Email:</strong> ${element.email}<br />    
                                </li>
                            `).join("")}
                        </ul>
                    `;

                    document.querySelector("#commentsMod al .modal-body").innerHTML = commentsList;

                    let myModal = new bootstrap.Modal(document.getElementById('commentsModal'));

                    myModal.show();

                });
            });
        }


        // useEffect(() => {}, [])

        // something {}
        // something []
        // [] -> Render / Rerender
        // [name] -> Render / Rerender / name changes
        // return () => {} -> Unrender 

        document.addEventListener("DOMContentLoaded", ()=>{
            populatePostsTable();

            

            document.getElementById("searchForm").addEventListener("submit", (event)=>{
                event.preventDefault();
                let userID = document.getElementById("userId").value;
                populatePostsTable(userID);
            });
        });
    </script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light"></nav>
        <div class="container-fluid">
          <a class="navbar-brand" href="#">Posts Dataset</a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"


            
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          
          <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
            <form class="d-flex" id="searchForm">
              <input
                class="form-control me-2"
                type="search"
                placeholder="User ID (Number)"
                id="userId"
                aria-label="Search"
              />
              <button class="btn btn-outline-success" type="submit">Search</button>
            </form>
          </div>
        </div>
      </nav>

      <br />

      <div class="container">
        <div class="row">
          <div class="col">
            <table class="table table-hover" id="postsTable">
              <thead>
                <tr>
                  <th>User ID</th>
                  <th>Title</th>
                  <th>Body</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Modal Windows -->

      <div class="modal fade" tabindex="-1" id="commentsModal">
        <div class="modal-dialog modal-xl">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Comments</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body"></div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
    
</body>
</html>